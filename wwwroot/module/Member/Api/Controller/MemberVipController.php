<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Api\Controller; use Illuminate\Routing\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use Module\Member\Auth\MemberUser; use Module\Member\Auth\MemberVip; use Module\Member\Constant\PayConstant; use Module\Member\Support\MemberLoginCheck; use Module\Member\Util\MemberVipUtil; use Module\PayCenter\Support\PayCenterPerform; use Module\Vendor\Type\OrderStatus; class MemberVipController extends Controller implements MemberLoginCheck { public function all() { return Response::generateSuccessData(MemberVipUtil::all()); } public function buy(PayCenterPerform $Lc1A1) { goto v3sxP; Te2in: return $Lc1A1->performSubmitOrder(PayConstant::MEMBER_VIP, $ys7LX['id'], $ys7LX['payFee'], '购买会员'); goto CZ3DK; AN2SI: if ($wb2ee < 0.01) { return Response::generateError('支付金额为空0.01'); } goto i_C2m; bdnzG: $ZSIA_ = $HoLMG->getInteger('vipId'); goto Z38F_; cgeCR: if ($a8BfN['code']) { return Response::generateError($a8BfN['msg']); } goto j8XO1; v3sxP: $HoLMG = InputPackage::buildFromInput(); goto bdnzG; O6s1t: if (empty($Ui2lF)) { return Response::generateError('请选择会员类型'); } goto k5IAQ; k5IAQ: $a8BfN = $this->calc($ZSIA_); goto cgeCR; kEazB: $Ui2lF = MemberVipUtil::get($ZSIA_); goto O6s1t; i_C2m: $ys7LX = ModelUtil::insert('member_vip_order', array('status' => OrderStatus::WAIT_PAY, 'memberUserId' => MemberUser::id(), 'vipId' => $Ui2lF['id'], 'payFee' => $wb2ee, 'expire' => $a8BfN['data']['expire'], 'type' => $a8BfN['data']['type'])); goto Te2in; j8XO1: $wb2ee = $a8BfN['data']['price']; goto AN2SI; Z38F_: if (empty($ZSIA_)) { return Response::generateError('请选择会员类型'); } goto kEazB; CZ3DK: } public function calc($ZSIA_ = 0) { goto HfhVH; N4e1A: $Ui2lF = MemberVip::get(); goto s2PUw; dRIYg: if (empty($ZSIA_)) { return Response::generateError('请选择会员'); } goto B3Ogq; B3Ogq: $mW7Vi = MemberVipUtil::calcPrice($Ui2lF ? $Ui2lF['id'] : 0, MemberUser::get('vipExpire'), $ZSIA_); goto nJK4f; nJK4f: if ($mW7Vi['code']) { return Response::generateError($mW7Vi['msg']); } goto xdc3t; s2PUw: if (empty($ZSIA_)) { $ZSIA_ = $HoLMG->getInteger('vipId'); } goto dRIYg; HfhVH: $HoLMG = InputPackage::buildFromInput(); goto N4e1A; xdc3t: return Response::generateSuccessData($mW7Vi['data']); goto QOQV5; QOQV5: } }