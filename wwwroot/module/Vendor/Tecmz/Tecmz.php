<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Tecmz; use Illuminate\Support\Facades\Log; use ModStart\Core\Input\Response; use ModStart\Core\Util\CurlUtil; use ModStart\Core\Util\SignUtil; class Tecmz { static $API_BASE = null; private $appId; private $appSecret; private $debug = false; public function __construct($eLuHr, $nWCk2 = null) { goto vjfWV; Q0cdg: $this->appSecret = $nWCk2; goto AN9pr; vjfWV: self::$API_BASE = 'https://api.tecmz.com/open_api'; goto AcsiN; AcsiN: $this->appId = $eLuHr; goto Q0cdg; AN9pr: } public function signCheck($HAqS9) { goto d_s3O; d_s3O: if (empty($HAqS9['sign']) || empty($HAqS9['timestamp']) || empty($HAqS9['app_id'])) { return false; } goto ghdgL; Vg4FT: if ($uCmst != $ax1CP) { return false; } goto lpxTh; ghdgL: if ($HAqS9['app_id'] != $this->appId) { return false; } goto eWSex; pD7SA: $ax1CP = SignUtil::common($HAqS9, $this->appSecret); goto Vg4FT; bW7m_: $uCmst = $HAqS9['sign']; goto RRTBT; eWSex: if ($HAqS9['timestamp'] < time() - 1800 || $HAqS9['timestamp'] > time() + 1800) { return false; } goto bW7m_; lpxTh: return true; goto hQWXK; RRTBT: unset($HAqS9['sign']); goto pD7SA; hQWXK: } public static function instance($eLuHr, $nWCk2 = null) { goto iyNU5; iyNU5: static $Wseaz = array(); goto bWd9s; OUn32: return $Wseaz[$eLuHr]; goto fCvli; bWd9s: if (!isset($Wseaz[$eLuHr])) { $Wseaz[$eLuHr] = new self($eLuHr, $nWCk2); } goto OUn32; fCvli: } public function setDebug($H7vqC) { $this->debug = $H7vqC; } private function request($ahLic, $HAqS9 = array()) { goto n62OB; IwxlI: if ($this->debug) { Log::debug('SoftAPI -> ' . self::$API_BASE . $ahLic . ' -> ' . json_encode($HAqS9)); } goto XtKdf; n62OB: $HAqS9['app_id'] = $this->appId; goto EP74_; EP74_: if ($this->appSecret) { $HAqS9['timestamp'] = time(); $HAqS9['sign'] = SignUtil::common($HAqS9, $this->appSecret); } goto IwxlI; XtKdf: return CurlUtil::postJSONBody(self::$API_BASE . $ahLic, $HAqS9); goto gU3PY; gU3PY: } public function ping() { goto Npz2E; R3f3h: if ($mW7Vi['code']) { return Response::generate(-1, 'PING失败'); } goto wzg5f; wzg5f: return Response::generate(0, 'ok'); goto OhjYg; Npz2E: $mW7Vi = $this->request('/ping'); goto R3f3h; OhjYg: } public function payOfflineCreate($a_MFm, $wb2ee, $C6uxI, $dw7HT) { return $this->request('/pay_offline/create', array('biz_sn' => $a_MFm, 'money' => $wb2ee, 'notify_url' => $C6uxI, 'return_url' => $dw7HT)); } public function captchaVerify($i2mg6, $T_BMM, $hRWBB, $Id2Xm, $HAEvk) { return $this->request('/captcha/verify', array('action' => $i2mg6, 'key' => $T_BMM, 'data' => $hRWBB, 'runtime' => $Id2Xm, 'types' => $HAEvk)); } public function captchaValidate($T_BMM) { return $this->request('/captcha/validate', array('key' => $T_BMM)); } public function smsSend($dEdul, $Hokub, $rqmPR = array()) { goto GUkT1; GUkT1: $F_g7l = array(); goto kSSdF; acBqC: return $this->request('/sms/send', array_merge(array('phone' => $dEdul, 'template_id' => $Hokub), $F_g7l)); goto BOscm; kSSdF: foreach ($rqmPR as $Zc0iK => $aEiYS) { $F_g7l["param_{$Zc0iK}"] = $aEiYS; } goto acBqC; BOscm: } public function audioConvert($PlIbm, $V0clk, $fboPt) { goto xt1cs; LECsd: $F_g7l['to'] = $V0clk; goto MhQsZ; t4NDD: $F_g7l['from'] = $PlIbm; goto LECsd; xt1cs: $F_g7l = array(); goto t4NDD; U6HUX: return $this->request('/audio_convert', $F_g7l); goto S0Mbj; MhQsZ: $F_g7l['content'] = $fboPt; goto U6HUX; S0Mbj: } public function asr($nKLrL, $fboPt) { goto Qyat4; ugDeF: $F_g7l['content'] = $fboPt; goto vqJhN; vqJhN: return $this->request('/asr', $F_g7l); goto WFdT7; Qyat4: $F_g7l = array(); goto snyPU; snyPU: $F_g7l['type'] = $nKLrL; goto ugDeF; WFdT7: } public function express($nKLrL, $Usa2S) { goto IJnAZ; MynwA: return $this->request('/express', $F_g7l); goto C3vNK; Juv7N: $F_g7l['no'] = $Usa2S; goto MynwA; Km4qN: $F_g7l['type'] = $nKLrL; goto Juv7N; IJnAZ: $F_g7l = array(); goto Km4qN; C3vNK: } public function censorImage($mU07K, $XSZk1) { goto B0lzE; haF_Y: return $this->request('/censor_image', $F_g7l); goto kHrZm; vwrMo: $F_g7l['imageBase64'] = $mU07K; goto IfgDb; IfgDb: $F_g7l['imageUrl'] = $XSZk1; goto haF_Y; B0lzE: $F_g7l = array(); goto vwrMo; kHrZm: } public function censorText($iXl9h) { goto pFhDg; pFhDg: $F_g7l = array(); goto xqJxH; xqJxH: $F_g7l['text'] = $iXl9h; goto q_h4t; q_h4t: return $this->request('/censor_text', $F_g7l); goto S3cj5; S3cj5: } public function ipToLocation($GHiFq) { goto xOOgy; x5WVO: return $this->request('/ip_to_location', $F_g7l); goto g18ro; P71GE: $F_g7l['ip'] = $GHiFq; goto x5WVO; xOOgy: $F_g7l = array(); goto P71GE; g18ro: } }