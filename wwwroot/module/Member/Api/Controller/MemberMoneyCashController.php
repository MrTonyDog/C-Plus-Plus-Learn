<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Api\Controller; use Illuminate\Routing\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use ModStart\Core\Type\TypeUtil; use Module\Member\Auth\MemberUser; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberMoneyCashType; use Module\Member\Util\MemberMoneyUtil; class MemberMoneyCashController extends Controller implements MemberLoginCheck { public function get() { goto XVH5H; XVH5H: $jh6GY = MemberMoneyUtil::getTotal(MemberUser::id()); goto dOFX6; ATprF: return Response::generateSuccessData(array('total' => $jh6GY, 'desc' => modstart_config('Member_MoneyCashDescription'), 'min' => sprintf('%0.2f', $wbuRK), 'rate' => modstart_config('Member_MoneyCashTaxRate', 0), 'types' => TypeUtil::dump(MemberMoneyCashType::class), 'canCash' => $jh6GY >= $wbuRK, 'defaultType' => MemberMoneyCashType::ALIPAY)); goto SnHB6; dOFX6: $wbuRK = modstart_config('Member_MoneyCashMin', 100); goto ATprF; SnHB6: } public function calc() { goto C27FN; s0lwX: $xebxm = 100 - min(max($xebxm, 0), 99); goto j561Z; Z1QLn: if ($wb2ee < modstart_config('Member_MoneyCashMin', 100)) { return Response::generateError('最小提现金额为' . modstart_config('Member_MoneyCashMin', 100)); } goto vOQOt; Vpkmv: $wb2ee = $HoLMG->getDecimal('money'); goto Z1QLn; vOQOt: $jh6GY = MemberMoneyUtil::getTotal(MemberUser::id()); goto mDVcn; j561Z: $Xiug2 = bcdiv(bcmul($wb2ee, $xebxm, 2), 100, 2); goto D79Rh; C27FN: $HoLMG = InputPackage::buildFromInput(); goto Vpkmv; S_246: $xebxm = modstart_config('Member_MoneyCashTaxRate', 0); goto s0lwX; D79Rh: return Response::generateSuccessData(array('value' => $Xiug2)); goto bceU7; mDVcn: if ($wb2ee > $jh6GY) { return Response::generateError('余额不足'); } goto S_246; bceU7: } public function submit() { goto G0oCy; oUSC_: $HoLMG = InputPackage::buildFromInput(); goto zVev1; pUc32: if ($jh6GY < modstart_config('Member_MoneyCashMin', 100)) { return Response::generate(-1, '当前账户余额不满' . modstart_config('Member_MoneyCashMin', 100) . ',不能提现'); } goto vDqRQ; FqJyv: if ($wb2ee < 0.01) { return Response::generate(-1, '提现金额不能为空'); } goto ZgFVz; sNZzY: $NXmo2 = bcdiv(bcmul($wb2ee, $xebxm, 2), 100, 2); goto ysiPy; jFtMs: return Response::generate(0, '提交成功', null, modstart_web_url('member_money/cash/log')); goto OFh6G; zVev1: $wb2ee = $HoLMG->getDecimal('money'); goto FqJyv; G0oCy: if (!modstart_config('Member_MoneyCashEnable', false)) { return Response::generateError('功能未开启'); } goto oUSC_; zBOvO: $jh6GY = MemberMoneyUtil::getTotal(MemberUser::id()); goto pUc32; ysiPy: try { goto daLeg; YIDHX: MemberMoneyUtil::cash(MemberUser::id(), $wb2ee, $NXmo2, MemberMoneyCashType::ALIPAY, $oAeaC, $yJ9uL); goto Nt9rS; daLeg: ModelUtil::transactionBegin(); goto YIDHX; Nt9rS: ModelUtil::transactionCommit(); goto M8nm1; M8nm1: } catch (\Exception $Dnvff) { ModelUtil::transactionRollback(); throw $Dnvff; } goto jFtMs; awQk3: switch ($nKLrL) { case MemberMoneyCashType::ALIPAY: goto nfoT5; isods: if (empty($oAeaC)) { return Response::generate(-1, '支付宝姓名不能为空'); } goto MFScm; vCU5d: break; goto TfDYx; nfoT5: $oAeaC = $HoLMG->getTrimString('alipayRealname'); goto kEXxh; MFScm: if (empty($yJ9uL)) { return Response::generate(-1, '支付宝账号不能为空'); } goto vCU5d; kEXxh: $yJ9uL = $HoLMG->getTrimString('alipayAccount'); goto isods; TfDYx: default: return Response::generateError('支付类型错误'); } goto zBOvO; HdnuD: $xebxm = 100 - min(max($xebxm, 0), 99); goto sNZzY; ZgFVz: if ($wb2ee < modstart_config('Member_MoneyCashMin', 100)) { return Response::generate(-1, '提现金额至少为' . modstart_config('Member_MoneyCashMin', 100)); } goto RI2E7; vDqRQ: $xebxm = modstart_config('Member_MoneyCashTaxRate', 0); goto HdnuD; RI2E7: $nKLrL = $HoLMG->getType('type', MemberMoneyCashType::class); goto awQk3; OFh6G: } public function log() { goto LVukZ; pJVdI: $wN_YM = MemberMoneyUtil::paginateCash(MemberUser::id(), $HoLMG->getPage(), $HoLMG->getPageSize(), $HxhmW); goto tqF_g; LVukZ: $HoLMG = InputPackage::buildFromInput(); goto SXsOL; tqF_g: return Response::generateSuccessPaginate($HoLMG->getPage(), $HoLMG->getPageSize(), $wN_YM); goto cbaNx; SXsOL: $HxhmW = array(); goto pJVdI; cbaNx: } }