<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; class WebAuthMiddleware { public function handle($FPoEp, \Closure $m3B93) { goto ce03G; thwHK: if ($H7GUl) { goto iaHC9; XAV6J: if ($qe8fj) { switch ($qe8fj['status']) { case MemberStatus::FORBIDDEN: $qe8fj = null; break; } } goto oTSy1; JXgzR: MemberUtil::processDefault($qe8fj); goto XAV6J; iaHC9: $qe8fj = MemberUtil::get($H7GUl); goto JXgzR; oTSy1: } goto YTKmc; ce03G: list($ADkeY, $i2mg6) = Request::getControllerAction(); goto VDNZK; eQfyW: return $m3B93($FPoEp); goto Sam9E; YaTgQ: View::share('_memberUserId', $H7GUl); goto kpwQp; mT5Do: Session::flash('_memberUser', $qe8fj); goto psoMf; YTKmc: if ($H7GUl && !$qe8fj) { $H7GUl = 0; Session::forget('memberUserId'); } goto YaTgQ; kpwQp: if (empty($H7GUl)) { if (is_subclass_of($ADkeY, MemberLoginCheck::class)) { if (property_exists($ADkeY, 'memberLoginCheckIgnores') && is_array($ADkeY::$memberLoginCheckIgnores) && in_array($i2mg6, $ADkeY::$memberLoginCheckIgnores)) { } else { return Response::send(-1, null, null, modstart_web_url('login') . '?redirect=' . urlencode(Request::currentPageUrl())); } } } goto ra7hN; ra7hN: Session::put('memberUserId', $H7GUl); goto mT5Do; psoMf: View::share('_memberUser', $qe8fj); goto eQfyW; VDNZK: $H7GUl = intval(Session::get('memberUserId', 0)); goto ATGKb; ATGKb: $qe8fj = null; goto thwHK; Sam9E: } }