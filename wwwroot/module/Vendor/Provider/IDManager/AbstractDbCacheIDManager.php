<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Provider\IDManager; use Illuminate\Support\Facades\Cache; abstract class AbstractDbCacheIDManager extends AbstractIDManager { public abstract function dbCacheAll(); private function clearCache() { Cache::forget($this->name() . '_All'); } public function all() { return Cache::rememberForever($this->name() . '_All', function () { return $this->dbCacheAll(); }); } public function add($JBiwJ) { $this->clearCache(); } public function remove($JBiwJ) { $this->clearCache(); } public function total() { return count($this->all()); } private function idsPaginate(&$JBiwJ, $ZcuyS, $iy20Z) { goto gvi2N; VKT_G: return $nChni; goto Ia96L; M50Vn: $nChni = array(); goto Wdruu; Wdruu: for ($grToB = $ORg7b; $grToB < $ORg7b + $iy20Z; $grToB++) { if (!isset($JBiwJ[$grToB])) { break; } $nChni[] = $JBiwJ[$grToB]; } goto VKT_G; qlu6O: $ORg7b = max($ZcuyS - 1, 0) * $iy20Z; goto Uq13f; gvi2N: $ZcuyS = max($ZcuyS, 1); goto qlu6O; Uq13f: if (!isset($JBiwJ[$ORg7b])) { return array(); } goto M50Vn; Ia96L: } public function paginate($ZcuyS, $iy20Z) { $JBiwJ = $this->all(); return $this->idsPaginate($JBiwJ, $ZcuyS, $iy20Z); } public function paginateRandom($ZcuyS, $iy20Z, $YcXMS = 'all', $MnwMt = 60) { $JBiwJ = Cache::remember($this->name() . '_Random_' . $YcXMS, $MnwMt, function () { $JBiwJ = $this->all(); shuffle($JBiwJ); return $JBiwJ; }); return $this->idsPaginate($JBiwJ, $ZcuyS, $iy20Z); } public function forgetRandom($YcXMS = 'all') { Cache::forget($this->name() . '_Random_' . $YcXMS); } }