<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\SDK; use ModStart\Core\Input\Response; use ModStart\Core\Util\CurlUtil; use Module\Vendor\Log\Logger; class HttpRequest { protected $LOG_FILE = 'base_request'; protected $LOG_PREFIX = 'BaseRequest'; protected $BASE_URL = ''; protected $REQUEST_INTERVAL_US = 0; protected function info($CAe7G, $mgOoi) { Logger::info($this->LOG_FILE, $this->LOG_PREFIX . '.' . $CAe7G, $mgOoi); } protected function error($CAe7G, $mgOoi) { Logger::error($this->LOG_FILE, $this->LOG_PREFIX . '.' . $CAe7G, $mgOoi); } public function setBaseUrl($fJmQF) { $this->BASE_URL = $fJmQF; } protected function post($K2Mwf, $HAqS9, $HxhmW = array()) { goto Q9sfA; a9Skp: $mVM8d = microtime(true); goto jiGiA; zjH5n: $this->info('PostRequest', array($K2Mwf, $HAqS9, $HxhmW)); goto a9Skp; aH9YH: $this->info('PostResponse', array('elapse ' . intval((microtime(true) - $mVM8d) * 1000) . 'ms', $K2Mwf, $mW7Vi)); goto ccku6; jiGiA: $mW7Vi = CurlUtil::post($this->BASE_URL . $K2Mwf, $HAqS9, $HxhmW); goto aH9YH; Q9sfA: if ($this->REQUEST_INTERVAL_US > 0) { usleep($this->REQUEST_INTERVAL_US); } goto zjH5n; yvn_t: return Response::generate(0, 'ok', $mW7Vi['body']); goto l_nFj; ccku6: if (!isset($mW7Vi['body'])) { $this->error('PostError', array($K2Mwf, $HAqS9, $HxhmW)); return Response::generate(-1, '请求失败(' . $K2Mwf . ')'); } goto yvn_t; l_nFj: } protected function postJSON($K2Mwf, $HAqS9, $HxhmW = array()) { goto lYxTZ; WrST0: $this->info('PostJSONResponse', array('elapse ' . intval((microtime(true) - $mVM8d) * 1000) . 'ms', $K2Mwf, $mW7Vi)); goto lLePK; rd80S: $mW7Vi = CurlUtil::postJSON($this->BASE_URL . $K2Mwf, $HAqS9, $HxhmW); goto WrST0; lYxTZ: if ($this->REQUEST_INTERVAL_US > 0) { usleep($this->REQUEST_INTERVAL_US); } goto a9yw2; lLePK: return $mW7Vi; goto v1l5q; a9yw2: $this->info('PostJSONRequest', array($K2Mwf, $HAqS9, $HxhmW)); goto h12Et; h12Et: $mVM8d = microtime(true); goto rd80S; v1l5q: } protected function get($K2Mwf, $HAqS9, $HxhmW = array()) { goto ZxIbj; ZxIbj: if ($this->REQUEST_INTERVAL_US > 0) { usleep($this->REQUEST_INTERVAL_US); } goto BUOWr; xWSIg: $mW7Vi = CurlUtil::get($this->BASE_URL . $K2Mwf, $HAqS9, $HxhmW); goto s5ul_; NSxjL: return Response::generate(0, 'ok', $mW7Vi['body']); goto Q5tjd; s5ul_: $this->info('GetRequest', array('elapse ' . intval((microtime(true) - $mVM8d) * 1000) . 'ms', $K2Mwf, $mW7Vi)); goto NSxjL; BUOWr: $this->info('GetRequest', array($K2Mwf, $HAqS9, $HxhmW)); goto apk13; apk13: $mVM8d = microtime(true); goto xWSIg; Q5tjd: } protected function getJSON($K2Mwf, $HAqS9, $HxhmW = array()) { goto M6maR; kGTHS: $mVM8d = microtime(true); goto GmeUl; M6maR: if ($this->REQUEST_INTERVAL_US > 0) { usleep($this->REQUEST_INTERVAL_US); } goto qQAM3; qQAM3: $this->info('GetJSONRequest', array($K2Mwf, $HAqS9, $HxhmW)); goto kGTHS; acowt: $this->info('GetJSONResponse', array('elapse ' . intval((microtime(true) - $mVM8d) * 1000) . 'ms', $K2Mwf, $mW7Vi)); goto Mx8NS; Mx8NS: return $mW7Vi; goto mMHWX; GmeUl: $mW7Vi = CurlUtil::getJSON($this->BASE_URL . $K2Mwf, $HAqS9, $HxhmW); goto acowt; mMHWX: } }