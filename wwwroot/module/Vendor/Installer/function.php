<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ goto JSj21; c00GU: function php_version_ok() { goto JzWCf; FJWST: if (version_compare(PHP_VERSION, '5.5.9', '<')) { return false; } goto hbsNN; JzWCf: if (INSTALL_APP_NAME == 'CMS9') { if (version_compare(PHP_VERSION, '8.0.0', '<')) { return false; } return true; } goto FJWST; mhcMI: return true; goto js1jv; hbsNN: if (version_compare(PHP_VERSION, '7.1.0', '>=')) { return false; } goto mhcMI; js1jv: } goto cosIF; RGGoE: function request_url() { return request_schema() . '://' . request_domain(); } goto rI4W7; EZNw2: if (file_exists($gMzn9 = APP_PATH . '/public/data_demo/data.php')) { define('DEMO_DATA', true); } goto HVrEp; cOE3P: include APP_PATH . '/vendor/modstart/modstart/src/Core/Env/EnvUtil.php'; goto DkEhO; qaKGg: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/CurlUtil.php'; goto JTXjj; Lbx3h: function env_writable() { goto Exjhl; xtBTj: $HvAUu = @file_get_contents($JJGcw); goto qkVnk; Z50Sy: return true; goto gFM_A; qkVnk: if (false === file_put_contents($JJGcw, $HvAUu)) { return false; } goto Z50Sy; GcFf5: if (!file_exists($JJGcw)) { goto fnmxV; Cqek1: @unlink($JJGcw); goto RGC1I; fnmxV: if (false === file_put_contents($JJGcw, '')) { @unlink($JJGcw); return false; } goto Cqek1; RGC1I: return true; goto ojl0t; ojl0t: } goto xtBTj; Exjhl: $JJGcw = APP_PATH . '/.env'; goto GcFf5; gFM_A: } goto YUyAu; ZMN2K: function env($T_BMM, $bw2yx = '') { goto QrIRK; QrIRK: static $pF7ZJ = null; goto Pxo50; Pxo50: if (null === $pF7ZJ) { $pF7ZJ = \ModStart\Core\Env\EnvUtil::all(ENV_FILE_EXAMPLE); } goto i6XSm; i6XSm: return isset($pF7ZJ[$T_BMM]) ? $pF7ZJ[$T_BMM] : $bw2yx; goto uvvY8; uvvY8: } goto DP6oC; YUyAu: function rewrite_check() { goto vcPZW; kVQSD: $K2Mwf = request_url() . '/install/ping'; goto gLj2N; mO17f: return array('code' => -1, 'msg' => 'Rewrite规则错误可能原因（仅供参考）：<br/>' . join('<br/>', $N9oEa)); goto hzsbB; flie5: $N9oEa[] = "- 您还可以在浏览器访问 <a href='{$K2Mwf}' target='_blank'>{$K2Mwf}</a> 查看报错信息，调整配置保证测试页面提示“ok”字样"; goto mO17f; gLj2N: $mW7Vi = \ModStart\Core\Util\CurlUtil::get($K2Mwf, array(), array('timeout' => 3)); goto wWNWW; lsalA: if (!empty($mW7Vi['error'])) { if (false !== strpos($mW7Vi['error'], 'Resolving timed out')) { $N9oEa[] = "- 域名 {$v09HR} 解析失败（可能您没有解析域名）"; $N9oEa[] = "- 在服务器不能访问 {$K2Mwf} ，需要在程序中通过改地址访问到程序"; } else { $N9oEa[] = '- ERROR:' . $mW7Vi['error']; } } goto x4pPi; lhdZw: $N9oEa = array(); goto lsalA; x4pPi: if (!empty($mW7Vi['code'])) { if (!empty($mW7Vi['body'])) { goto qGqeV; X0Cg0: $N9oEa[] = '- 程序出错:' . preg_replace('/\\s+/', ' ', preg_replace('/<[^>]+>/', '', $mgOoi)); goto clBVt; I9JWh: if (false !== $D01Cg) { $mgOoi = substr($mgOoi, $D01Cg); } goto bUFDY; SPkUd: if (false !== $D01Cg) { $mgOoi = substr($mgOoi, 0, $D01Cg); } goto X0Cg0; YbX9E: $D01Cg = strpos($mW7Vi['body'], '<body>'); goto I9JWh; bUFDY: $D01Cg = strpos($mW7Vi['body'], '</body>'); goto SPkUd; qGqeV: $mgOoi = $mW7Vi['body']; goto YbX9E; clBVt: } } goto flie5; wWNWW: if ($mW7Vi['body'] === 'ok') { return array('code' => 0, 'msg' => ''); } goto lhdZw; d5jA6: $v09HR = request_domain(); goto kVQSD; vcPZW: if (file_exists(APP_PATH . '/storage/rewrite.skip')) { return array('code' => 0, 'msg' => 'ok'); } goto d5jA6; hzsbB: } goto ZMN2K; bmKWO: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/RandomUtil.php'; goto qaKGg; H2_5O: if (file_exists($zgvBC = APP_PATH . '/license_url.txt')) { define('LICENSE_URL', trim(file_get_contents($zgvBC))); } goto EZNw2; EuvKN: if (!defined('INSTALL_APP_NAME')) { define('INSTALL_APP_NAME', 'APP'); } goto x0fxZ; nEJG0: function php_version_requires() { if (INSTALL_APP_NAME == 'CMS9') { return join('，', array('8.0.x', '8.1.x')); } return join(', ', array(INSTALL_APP_NAME, '5.6.x', '7.0.x')); } goto c00GU; JTXjj: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/FileUtil.php'; goto JGaRW; v6I24: if (file_exists($kbmb0 = APP_PATH . '/app/Constant/AppConstant.php')) { include $kbmb0; } goto cOE3P; zOLZ5: define('ENV_FILE_EXAMPLE', APP_PATH . '/env.example'); goto AdWBC; rI4W7: function request_is_post() { return !empty($_POST); } goto SRtOq; XL218: function text_success($mgOoi) { echo '<div class="ub-alert ub-alert-success">√ ' . $mgOoi . '</div>'; } goto feUIO; DkEhO: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/EnvUtil.php'; goto bmKWO; JSj21: define('APP_PATH', realpath(__DIR__ . '/../../../')); goto v6I24; HVrEp: if (class_exists(\App\Constant\AppConstant::class)) { if (defined('\\App\\Constant\\AppConstant::APP')) { define('INSTALL_APP_NAME', strtoupper(\App\Constant\AppConstant::APP)); } if (defined('\\App\\Constant\\AppConstant::VERSION')) { define('INSTALL_APP_VERSION', \App\Constant\AppConstant::VERSION); } } goto EuvKN; x4ESF: function response_json_quit($BF1ZP, $mgOoi, $hRWBB = null, $vB6nX = null) { goto lIPi7; xQlLi: die; goto g23yl; lIPi7: header('Content-type: application/json'); goto FyBSb; FyBSb: echo json_encode(array('code' => $BF1ZP, 'msg' => $mgOoi, 'data' => $hRWBB, 'redirect' => $vB6nX)); goto xQlLi; g23yl: } goto vVF0T; feUIO: function text_error($mgOoi, $ZNXAm = null, $UPl2L = true) { if ($UPl2L) { error_counter(); } echo '<div class="ub-alert ub-alert-danger">× ' . $mgOoi . ' ' . ($ZNXAm ? '<a target="_blank" href="' . $ZNXAm . '">解决办法</a>' : '') . '</div>'; } goto KqNNh; AdWBC: define('ENV_FILE', APP_PATH . '/.env'); goto H2_5O; uVlpN: function request_post($Zc0iK, $bw2yx = '') { return isset($_POST[$Zc0iK]) ? $_POST[$Zc0iK] : $bw2yx; } goto XL218; SRtOq: function is_https() { if (!empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off') { return true; } elseif (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') { return true; } elseif (!empty($_SERVER['HTTP_FRONT_END_HTTPS']) && strtolower($_SERVER['HTTP_FRONT_END_HTTPS']) !== 'off') { return true; } return false; } goto uVlpN; YFr1Y: function response_json_error_quit($mgOoi) { response_json_quit(-1, $mgOoi); } goto x4ESF; vVF0T: function request_schema() { goto yy683; yy683: $jIw2v = 'http'; goto DVdIp; DVdIp: if (is_https()) { $jIw2v = 'https'; } goto xanuC; xanuC: return $jIw2v; goto hgz3S; hgz3S: } goto k2NT4; k2NT4: function request_domain() { return $_SERVER['HTTP_HOST']; } goto RGGoE; JGaRW: define('INSTALL_LOCK_FILE', APP_PATH . '/storage/install.lock'); goto zOLZ5; yx5uE: if (!file_exists(ENV_FILE)) { file_put_contents(ENV_FILE, 'APP_ENV=beta
APP_DEBUG=true
APP_KEY=' . \ModStart\Core\Util\RandomUtil::string(32)); } goto nEJG0; KqNNh: function error_counter($MVzaL = 1) { goto xEsxf; xEsxf: static $YUtic = 0; goto mygOJ; Gb18k: return $YUtic; goto PlUft; mygOJ: $YUtic += $MVzaL; goto Gb18k; PlUft: } goto Lbx3h; cosIF: function get_env_config($T_BMM, $pFp4C = '') { goto n2VK4; fx5j8: if (isset($oWIio[$T_BMM])) { return $oWIio[$T_BMM]; } goto xnM5l; WZcUS: if (isset($KdH4R[$T_BMM])) { return env($KdH4R[$T_BMM], $pFp4C); } goto myBuI; n2VK4: static $oWIio = null; goto Ow1kK; myBuI: return $pFp4C; goto WHkga; xnM5l: $KdH4R = array('db_host' => 'DB_HOST', 'db_name' => 'DB_DATABASE', 'db_username' => 'DB_USERNAME', 'db_password' => 'DB_PASSWORD', 'db_prefix' => 'DB_PREFIX', 'admin_username' => 'ADMIN_USERNAME', 'admin_password' => 'ADMIN_PASSWORD'); goto WZcUS; Ow1kK: if (null == $oWIio) { $oWIio = array(); if (!empty($YU0f8 = glob(APP_PATH . '/env.*.json'))) { foreach ($YU0f8 as $fUSmS) { $Bjq3O = @json_decode(@file_get_contents($fUSmS), true); if (!empty($Bjq3O)) { $oWIio = array_merge($oWIio, $Bjq3O); } } } } goto fx5j8; WHkga: } goto YFr1Y; x0fxZ: if (!defined('INSTALL_APP_VERSION')) { define('INSTALL_APP_VERSION', '0.0.0'); } goto yx5uE; DP6oC: function is_dir_really_writable($sBxtO) { goto MWXmu; RrHiY: return true; goto PTRJG; Jf7be: @unlink($pC1gM); goto RrHiY; MWXmu: $sBxtO = rtrim($sBxtO, '/\\') . '/'; goto R2waP; xVBrO: @file_put_contents($pC1gM, 'test'); goto vu133; R2waP: $pC1gM = $sBxtO . '.writable_test_file'; goto xVBrO; DVN3I: if (file_get_contents($pC1gM) != 'test') { return false; } goto Jf7be; vu133: if (!file_exists($pC1gM)) { return false; } goto DVN3I; PTRJG: }