<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; use Module\Vendor\Support\ResponseCodes; class ApiAuthMiddleware { public function handle($FPoEp, \Closure $m3B93) { goto dlM0e; o9eP_: if ($H7GUl && !$qe8fj) { $H7GUl = 0; Session::forget('memberUserId'); } goto CIjnO; lKbmK: Session::put('memberUserId', $H7GUl); goto Zo_Lm; cAl7l: $H7GUl = intval(Session::get('memberUserId', 0)); goto lq2yP; kjKuG: return $m3B93($FPoEp); goto OsKhS; Zo_Lm: Session::flash('_memberUser', $qe8fj); goto kjKuG; lq2yP: $qe8fj = null; goto p5Qr9; p5Qr9: if ($H7GUl) { goto qcAxh; mVKZZ: if ($qe8fj) { switch ($qe8fj['status']) { case MemberStatus::FORBIDDEN: $qe8fj = null; break; } } goto vJ1Nl; qcAxh: $qe8fj = MemberUtil::get($H7GUl); goto Eok51; Eok51: MemberUtil::processDefault($qe8fj); goto mVKZZ; vJ1Nl: } goto o9eP_; dlM0e: list($ADkeY, $i2mg6) = Request::getControllerAction(); goto cAl7l; CIjnO: if (empty($H7GUl)) { if (is_subclass_of($ADkeY, MemberLoginCheck::class)) { if (property_exists($ADkeY, 'memberLoginCheckIgnores') && is_array($ADkeY::$memberLoginCheckIgnores) && in_array($i2mg6, $ADkeY::$memberLoginCheckIgnores)) { } else { return Response::json(ResponseCodes::LOGIN_REQUIRED, '请登录', null, modstart_web_url('login', array('redirect' => Request::currentPageUrl()))); } } } goto lKbmK; OsKhS: } }