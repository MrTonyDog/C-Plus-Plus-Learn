<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Config; use Illuminate\Support\Str; class MemberMenu { private static $menu = array(); public static function register($pDrOS) { self::$menu[] = $pDrOS; } public static function get() { goto iPAN0; J2pxQ: return $pDrOS; goto QYDF9; aAYhN: foreach (self::$menu as $KdsT8) { if ($KdsT8 instanceof \Closure) { $KdsT8 = call_user_func($KdsT8); } $pDrOS = array_merge($pDrOS, $KdsT8); } goto fwl85; iPAN0: $pDrOS = array(); goto aAYhN; fwl85: $pDrOS = self::mergeMenu($pDrOS); goto J2pxQ; QYDF9: } private static function sort() { static $PcBmw = 1000; return $PcBmw++; } private static function mergeMenu($pDrOS, $zBMcE = '', $oswCg = 1, $P2EU9 = null) { goto wMwgV; IcT0C: foreach ($pDrOS as $KdsT8) { goto QF3Zk; qCe7c: if (!isset($rqY0_[$Zc0iK])) { $rqY0_[$Zc0iK] = $KdsT8; } goto ANrUr; QF3Zk: if (empty($KdsT8)) { continue; } goto oTci1; sF0ct: if (isset($KdsT8['icon'])) { if (preg_match('/^[a-zA-Z0-9\\-]+$/', $KdsT8['icon'])) { $KdsT8['icon'] = "<i class='icon iconfont icon-{$KdsT8['icon']}'></i>"; } } goto qCe7c; Zizpf: if (!empty($KdsT8['children'])) { $rqY0_ = array_merge($rqY0_, self::mergeMenu($KdsT8['children'], $Zc0iK . '^^', $oswCg + 1, $P2EU9)); } goto OD93p; fomnH: if (!isset($KdsT8['sort'])) { $KdsT8['sort'] = self::sort(); } goto FouCz; ANrUr: unset($rqY0_[$Zc0iK]['children']); goto Zizpf; oTci1: if ($P2EU9) { if (!call_user_func($P2EU9, $KdsT8)) { continue; } } goto fomnH; FouCz: if (1 == $oswCg) { $Zc0iK = $zBMcE . $KdsT8['title'] . '^' . $KdsT8['icon'] . '^' . $KdsT8['sort']; } else { $Zc0iK = $zBMcE . $KdsT8['title']; } goto sF0ct; OD93p: } goto fvEvT; DqrAn: return $rqY0_; goto jmR26; wMwgV: if (empty($pDrOS)) { return array(); } goto r4xOH; r4xOH: $rqY0_ = array(); goto IcT0C; fvEvT: if ($oswCg == 1) { uasort($rqY0_, function ($cGnks, $rnjjQ) { return $cGnks['sort'] - $rnjjQ['sort']; }); return self::mergeMenuTree($rqY0_); } goto DqrAn; jmR26: } private static function mergeMenuTree($qizvO, $zBMcE = '') { goto UZgjb; UZgjb: $ayd9d = array(); goto AgnEf; EgZOp: return $ayd9d; goto pW7fC; AgnEf: foreach ($qizvO as $Zc0iK => $aEiYS) { goto QCO1r; Jl4HR: $KdsT8['children'] = self::mergeMenuTree($qizvO, $Zc0iK . '^^'); goto iMIuq; Akjpc: $UuN2f = explode('^^', $Zc0iK); goto jt7Cs; GtMf9: $KdsT8 = $aEiYS; goto Jl4HR; iMIuq: if (empty($KdsT8['children'])) { unset($KdsT8['children']); } goto dmOCQ; J_sb7: $ayd9d[] = $KdsT8; goto M2NSu; jt7Cs: if ($zBMcE) { if (!Str::startsWith($Zc0iK, $zBMcE)) { continue; } if (count(explode('^^', $zBMcE)) !== count(explode('^^', $Zc0iK))) { continue; } } else { if (1 != count($UuN2f)) { continue; } } goto GtMf9; QCO1r: if ($Zc0iK === $zBMcE) { continue; } goto Akjpc; dmOCQ: if (empty($KdsT8['children']) && empty($KdsT8['url'])) { continue; } goto J_sb7; M2NSu: } goto EgZOp; pW7fC: } }